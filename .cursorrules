# React + TypeScript Universal Design System
# Version: 1.0 | Last Updated: 2026-02-04 | Maintainer: [Your Name]

## PHILOSOPHY
Defines HOW we build, not exact visual values.
- Visual decisions → src/styles/tokens.css
- Project style → PROJECT-SPECIFIC OVERRIDES
- External designs → DESIGN-FIRST MODE (see docs/design-first.md)

## PROJECT SETUP
Project: [PROJECT_NAME]
Stack: React 18 + TypeScript + Vite + CSS Modules
Design System: Token-based, WCAG 2.1 AA
Status: [Development / Production]

## WHERE THINGS LIVE
- Tokens: src/styles/tokens.css
- Components: src/components/
- Pages/routes: src/pages/ or src/routes/
- Hooks: src/hooks/
- Utils: src/utils/
- API: src/api/

## DOCS REFERENCE
- Design tokens: docs/design-system.md
- Components: docs/component-patterns.md
- Accessibility: docs/accessibility.md
- Performance: docs/performance.md
- Styling: docs/styling.md
- Layout: docs/layout-grids.md
- Design-First: docs/design-first.md
- Setup: docs/implementation-checklist.md
- Data fetching: docs/data-fetching.md
- UX patterns: docs/ux-patterns.md
- Anti-patterns & AI guardrails: docs/anti-patterns.md
- Routing: docs/routing.md
- Testing: docs/testing.md

## CORE PRINCIPLES (Immutable)
1. Components over complexity
2. Composition over inheritance
3. Accessibility by default
4. Performance-first
5. Type-safe everything
6. Mobile-first responsive
7. Design token adherence
8. Semantic HTML
9. Progressive enhancement
10. Consistency through constraints

## DESIGN SYSTEM (How, not What)

### Token Usage
- Use CSS variables from tokens.css exclusively
- Format: var(--color-primary), var(--space-md)
- No hardcoded values in Template mode
- Exception: Design-First mode (see below)

### Spacing
- Only values from tokens.css (typically 8px-based)
- No arbitrary values (no 13px, 27px)

### Colors
- Semantic naming: --color-primary, --color-error
- Support [data-theme] for light/dark
- WCAG 2.1 AA contrast required

### Typography
- Scale from tokens.css
- Line-heights: 1.2–1.6 range
- Weights: Only defined weights

### Touch Targets
- Minimum: 44×44px (iOS)
- Buttons: 40–48px height
- Icon buttons: 40×40px minimum

### Border Radius
- Only tokens.css values
- Consistency across similar components

### Breakpoints
- From tokens.css
- Mobile-first (min-width)

## CODE STANDARDS (Immutable)

### Structure
- Component: ComponentName/ComponentName.tsx + .module.css
- Max 300 lines per file
- Co-locate related files

### TypeScript
- All props: interfaces
- No `any` (use `unknown`)
- Discriminated unions for variants
- JSDoc for public APIs

### React
- Functional components only
- Hooks for state/effects
- Composition via children/render props
- Context only for global state
- No prop drilling > 2 levels

### Naming
- Components: PascalCase
- Functions/vars: camelCase
- Constants: UPPER_SNAKE_CASE
- CSS classes: camelCase
- CSS variables: kebab-case

### Styling
- CSS Modules only
- No inline styles (except dynamic)
- Mobile-first media queries
- Use tokens exclusively

### Comments
- Swedish for complex logic
- Explain WHY, not WHAT
- JSDoc for public APIs

### Imports (order)
1. React
2. Third-party
3. Internal utils/hooks
4. Components
5. Types
6. Styles

## ACCESSIBILITY (WCAG 2.1 AA – Immutable)
- Semantic HTML (button, nav, main)
- ARIA when semantic insufficient
- Focus visible (2px outline, 4px offset)
- Keyboard navigation
- Contrast: 4.5:1 text, 3:1 UI
- Alt text for images
- Form labels and errors

## PERFORMANCE (Immutable)
- Lazy load routes
- Code split at route level
- Optimize images (WebP, lazy load)
- Minimize re-renders (when profiled)
- Bundle < 200KB initial

## ANTI-PATTERNS (Never)
❌ Hardcoded values → Use tokens
❌ Inline styles → Use CSS Modules
❌ Missing types → Always type props
❌ Prop drilling > 2 levels → Context/composition
❌ God components > 300 lines → Split
❌ Data fetching in UI → Hooks/services
❌ Skip accessibility → WCAG mandatory

## DESIGN-FIRST MODE
**When user provides explicit visual design**

### Override Hierarchy
1. User command ("exactly", "pixel-perfect", "ignore template")
2. Visual design provided (screenshot, mockup, spec)
3. PROJECT-SPECIFIC OVERRIDES
4. Universal template rules

### Three Modes
**Template** (default):
- Follow all rules strictly
- Use tokens exclusively

**Balanced** (design provided):
- Match design, use tokens where sensible
- Add accessibility

**Design-First** (explicit keywords):
- Pixel-perfect implementation
- Exact values, ignore tokens if needed
- Only deviate for accessibility/performance

### Trigger Keywords
"exactly as shown", "pixel-perfect", "ignore template", "client specification"

### Rules
- ✅ Implement design AS SHOWN
- ✅ Off-grid/asymmetric OK if intentional
- ✅ No border-radius OK if design specifies
- ⚠️ STILL add accessibility (doesn't change visual)
- ⚠️ STILL semantic HTML
- ⚠️ STILL optimize performance

**Details & examples: docs/design-first.md**

## PROJECT-SPECIFIC OVERRIDES
**THIS SECTION OVERRIDES ABOVE IF CONFLICTS**

### [PROJECT_NAME] – Visual Style
Style: [Modern/Traditional/Brutalist/Minimal/Elegant]
Tone: [Professional/Casual/Technical/Friendly/Bold]
Visual Language:
- Typography: [Clean/Bold/Elegant/Conservative]
- Spacing: [Tight/Generous/Balanced/Airy]
- Corners: [Sharp/Rounded/Mixed/None]
- Motion: [Minimal/Smooth/Energetic/Snappy]
- Shadows: [Flat/Subtle/Pronounced/None]
Do:
- [Guideline 1]
- [Guideline 2]
- [Guideline 3]
Don't:
- [Anti-pattern 1]
- [Anti-pattern 2]
- [Anti-pattern 3]

### [PROJECT_NAME] – Design Fidelity
Mode: [Strict Template / Balanced / Design-First]
Rationale: Strict = internal, consistency; Balanced = client, adapt to brand; Design-First = pixel-perfect required.

### [PROJECT_NAME] – Technical
API: [REST/GraphQL] – Location: src/api/
State: [Context/Zustand/Redux]
Forms: [React Hook Form/Formik] – Validation: [Zod/Yup]
Routing: [React Router/Tanstack]
Testing: [Vitest/Jest + RTL]
Special: [Constraints]

## AI FLEXIBILITY

**FLEXIBLE (per project):**
- Token VALUES (tokens.css)
- Visual style (OVERRIDES)
- Spacing/typography details
- Component variants
- Animation timing
- Color palette
- Border radius
- Shadow depth

**IMMUTABLE:**
- Token-based approach (Template mode)
- Accessibility standards
- TypeScript requirements
- File structure
- Performance guidelines
- Code quality
- Semantic HTML

## AI GUIDELINES

### Before Code
1. Check for Design-First keywords
2. Read PROJECT-SPECIFIC OVERRIDES
3. Check tokens.css for values
4. Review relevant docs/
5. Look at existing components

### When Generating
1. Determine mode (Template/Balanced/Design-First)
2. Use appropriate values (tokens vs exact)
3. TypeScript interfaces
4. Accessibility attributes
5. Mobile-first
6. Swedish comments for complex logic
7. Performance consideration
8. Keyboard navigation

### If Uncertain
1. Ask about style preference
2. Ask which mode if design provided
3. Check existing components
4. Default to accessible/performant
5. Reference docs/ for details

### Output Checklist
- Types for all props and returns
- Semantic elements (button, nav, main, etc.)
- Focus and keyboard support
- Tokens (or explicit Design-First note)
- Mobile-first styles
- No file over 300 lines

## BUILD ORDER
When building a new feature, follow this sequence:
1. Types first (src/types/)
2. Schema (src/schemas/) — Zod validation for API responses
3. API layer (src/api/) — fetch + validation
4. Hook (src/hooks/) — React Query wrapper + business logic
5. Component (src/components/) — presentation only
6. Self-audit against docs/anti-patterns.md

Never skip steps. Each layer depends on the previous one.

## REVIEW PROTOCOL
After completing any feature, run a self-audit against docs/anti-patterns.md.
For each rule (1.1 through 8.4), check all new/modified files and report:
- Rule number and name
- PASS or FAIL
- If FAIL: which file, which line, and the fix

Do NOT modify files during audit — read-only. Fix only after reporting all results.
## VERSION HISTORY
- v1.0 (2026-02-04): Universal template
  - Principle-based (how, not what)
  - PROJECT-SPECIFIC OVERRIDES
  - DESIGN-FIRST MODE
  - Stable vs variable layers
  - Override hierarchy

## ENFORCEMENT
Principles STRICT. Values FLEXIBLE per project/mode.
AI must treat docs/anti-patterns.md as hard constraints and avoid generating code that violates these rules.

**FILE SAFETY:** Never delete, rename, or modify any files other than the ones explicitly requested. If a task requires creating new files, ONLY create those files — do not touch existing files unless instructed.

Changes:
- New token → Request (don't hardcode in Template)
- Visual style → Update OVERRIDES
- External design → Use Design-First mode
- Break principle → Ask first (likely NO)
- Project pattern → Document in OVERRIDES

When in doubt: principles STRICT, values FLEXIBLE. Respect user designs; never sacrifice accessibility or performance.

## CHANGELOG
[DATE]: [Changes and rationale]

---
~300 lines. Principles stable. Values flexible. Designs respected.
